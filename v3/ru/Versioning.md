---
title: Управление версиями
layout: basic
---

# Управление версиями #

Разделение Api на несколько версий необходимо для совершенствования без ущерба обратной совместимости. С одной стороны, любое изменение программного интерфейса может [нарушить](http://blogs.msdn.com/b/ericlippert/archive/2012/01/09/every-public-change-is-a-breaking-change.aspx) работу существующих плагинов, с другой стороны, изменения вносить необходимо. Для решения этой дилеммы история развития Api делится на версии: в определённый момент времени разработка очередной версии прекращается, интерфейс фиксируется, дальнейшее развитие продолжается в рамках следующей версии. Какие бы изменения ни вносились в будущем, разработанный под зафиксированную версию плагин будет исправно функционировать до тех пор, пока эта версия не перестанет поддерживаться.

## Жизненный цикл версий ##
Версии нумеруются по порядку целыми числами — V1, V2, V3 и так далее. Одновременно поддерживаются три последние версии, которым в хронологическом порядке соответствуют следующие характеристики:

- устаревшая;
- стабильная;
- предварительная.

Стабильная версия — это наиболее новая зафиксированная версия, именно под неё рекомендуется разрабатывать плагины. Устаревшая версия — это прежняя стабильная версия, она обеспечивает совместимость с ранее разработанными плагинами. Ну и, наконец, для ознакомления доступна предварительная версия — она так называется потому, что её интерфейс ещё не зафиксирован, возможны любые изменения. С выпуском очередной версии роли перераспределяются следующим образом:

- поддержка устаревшей версии прекращается;
- версия, которая была стабильной, объявляется устаревшей;
- версия, которая была предварительной, фиксируется и становится стабильной;
- появляется новая версия.

Например, текущие три версии — это V1, V2 и V3. Разработку под V1 лучше даже не начинать, это бесперспективно. V2 — стабильная версия, её можно безопасно использовать для массово внедряемых плагинов, не опасаясь, что после очередного обновления у некоторых пользователей плагин перестанет работать. Версия V3 пока носит статус предварительной, но её всё-таки можно использовать с определёнными ограничениями. Во-первых, можно изучить нововведения и начать разработку плагина для предстоящей версии, чтобы к моменту её выпуска иметь готовый или почти готовый плагин, предоставляющий новые возможности. Во-вторых, можно начать использовать новые возможности, не дожидаясь объявления версии стабильной, но следует учитывать, что такой плагин будет совместим только с конкретной сборкой iiko, поэтому придётся поддерживать тесный контакт с пользователем, чтобы перед установкой новой сборки протестировать работу плагина и при необходимости внести исправления. Когда версия V3 будет объявлена стабильной, поддержка V1 будет прекращена, а разработанные под V2 плагины надо будет постепенно переводить на V3. Пока будет идти разработка V4, V2-плагины всё ещё будут поддерживаться, но рано или поздно разработка V4 завершится, появится V5, и тогда V2 перестанет поддерживаться.

Такой подход позволяет совместить интересы разработчиков iiko, которые не могут вечно поддерживать все когда-либо выпущенные версии Api, разработчиков плагинов, которые с выходом новой версии Api не могут мгновенно переписать и перетестировать под неё плагины, и пользователей, которые при выпуске новых сборок iiko зачастую не готовы ждать обновления плагинов.

## Использование различных версий ##
Версия Api, под которую разработан плагин, определяется по версии интерфейса `IFrontPlugin`, который он реализует. Например, если плагин реализует интерфейс `Resto.Front.Api.V3.IFrontPlugin`, это V3-плагин. Предполагается, что V3-плагин имеет ссылку на сборку `Resto.Front.Api.V3.dll` и использует программный интерфейс версии V3. Тем не менее, при необходимости плагин может одновременно использовать все поддерживаемые версии Api. Например, чтобы получить доступ к операции, которая появилась только в V4, достаточно добавить ссылку на сборку `Resto.Front.Api.V4.dll` и из `IServiceProvider`, переданного в метод `Init`, извлечь сервис `Resto.Front.Api.V4.IOperationService`. Важно: не следует одновременно реализовывать интерфейсы `IFrontPlugin` разных версий, это приведёт к созданию нескольких экземпляров плагина. 